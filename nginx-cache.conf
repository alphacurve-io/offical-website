# Nginx configuration for optimal caching of static assets
# Place this in your nginx site configuration or include it

# Cache static assets with content hashes (long cache time)
# Files with hashes in their names (e.g., main.e0903950.js) can be cached for 1 year
# because the hash changes when content changes, ensuring cache invalidation
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|mp4|webm|webp)$ {
    # Cache for 1 year (31536000 seconds)
    expires 1y;
    add_header Cache-Control "public, immutable, max-age=31536000";
    
    # Enable compression
    gzip_static on;
    
    # CORS headers if needed
    add_header Access-Control-Allow-Origin "*";
}

# Cache HTML files for shorter time (4 hours) since they may change more frequently
# But you can increase this if you use proper cache busting
location ~* \.(html)$ {
    expires 4h;
    add_header Cache-Control "public, max-age=14400";
}

# Cache manifest and other JSON files
location ~* \.(json|webmanifest)$ {
    expires 1d;
    add_header Cache-Control "public, max-age=86400";
}

# Enable gzip compression for text-based files
gzip on;
gzip_vary on;
# Lower minimum length to compress smaller files (256 bytes instead of 1000)
gzip_min_length 256;
gzip_proxied any;
# Maximum compression level (9) for best compression ratio
# Note: Higher levels use more CPU, but since we pre-compress files, this mainly affects dynamic content
gzip_comp_level 9;
# Disable compression for already compressed files
gzip_disable "msie6";
# Buffer settings for better performance
gzip_buffers 16 8k;
gzip_http_version 1.1;
gzip_types
    text/html
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml
    application/xml+rss
    application/rss+xml
    application/wasm
    application/manifest+json
    font/truetype
    font/opentype
    font/woff
    font/woff2
    application/vnd.ms-fontobject
    image/svg+xml;

# Enable brotli compression if available (better than gzip)
# Uncomment if you have brotli module installed
# brotli on;
# brotli_comp_level 6;
# brotli_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/rss+xml font/truetype font/opentype application/vnd.ms-fontobject image/svg+xml;
